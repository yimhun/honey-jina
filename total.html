<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ï†ÑÏ≤¥ ÍøÄÌÜµ üçØ</title>
    <link href="https://fonts.googleapis.com/css2?family=Single+Day&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #E8EAF6 0%, #C5CAE9 100%);
            min-height: 100vh;
            padding-bottom: 30px;
        }

        .header {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header .emoji {
            font-size: 36px;
            display: inline-block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .month-filter {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .month-filter h3 {
            color: #7B1FA2;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 700;
        }

        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .month-btn {
            background: #F3E5F5;
            border: 2px solid #CE93D8;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #7B1FA2;
            font-weight: 600;
        }

        .month-btn:active {
            transform: scale(0.95);
            background: #9C27B0;
            color: white;
        }

        .current-month {
            font-size: 20px;
            font-weight: 700;
            color: #6A1B9A;
            min-width: 120px;
            text-align: center;
        }

        .total-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .total-card h2 {
            color: #7B1FA2;
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }

        .incentive-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .incentive-box {
            background: linear-gradient(135deg, #BA68C8 0%, #AB47BC 100%);
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }

        .incentive-box.funding {
            background: linear-gradient(135deg, #EF5350 0%, #E53935 100%);
        }

        .incentive-box .label {
            font-size: 13px;
            color: white;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .incentive-box .amount {
            font-size: 26px;
            font-weight: 800;
            color: white;
        }

        .branch-section {
            margin-top: 25px;
        }

        .branch-section h3 {
            color: #7B1FA2;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .branch-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-left: 5px solid #9C27B0;
        }

        .branch-card.gyeyang {
            border-left-color: #FFA726;
            background: linear-gradient(to right, #FFF8E1 0%, white 20%);
        }

        .branch-card.yeonsu {
            border-left-color: #F06292;
            background: linear-gradient(to right, #FFF0F5 0%, white 20%);
        }

        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .branch-name {
            font-size: 20px;
            font-weight: 700;
        }

        .branch-card.gyeyang .branch-name {
            color: #FF8C00;
        }

        .branch-card.yeonsu .branch-name {
            color: #E91E63;
        }

        .detail-btn {
            background: #9C27B0;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .detail-btn:active {
            transform: scale(0.95);
        }

        .branch-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(156, 39, 176, 0.05);
            border-radius: 10px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #7B1FA2;
        }

        .product-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .product-section h3 {
            color: #7B1FA2;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .product-item {
            background: #F3E5F5;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 2px solid #CE93D8;
        }

        .product-name {
            font-size: 15px;
            font-weight: 700;
            color: #6A1B9A;
            margin-bottom: 10px;
        }

        .product-details {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .product-total {
            text-align: right;
            font-size: 16px;
            font-weight: 700;
            color: #7B1FA2;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #CE93D8;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #7B1FA2;
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 24px;
            }

            .incentive-box .amount {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="nav-buttons">
            <a href="index.html" class="nav-btn">‚Üê Î©îÏù∏ÏúºÎ°ú</a>
        </div>
        <div class="emoji">üçØ</div>
        <h1>Ï†ÑÏ≤¥ ÍøÄÌÜµ</h1>
    </div>

    <div class="container">
        <div class="month-filter">
            <h3>üìÖ Ï°∞Ìöå Ïõî</h3>
            <div class="month-selector">
                <button class="month-btn" onclick="changeMonth(-1)">‚óÄ</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-btn" onclick="changeMonth(1)">‚ñ∂</button>
            </div>
        </div>

        <div class="total-card">
            <h2>üí∞ Ï†ÑÏ≤¥ ÎàÑÏ†Å Ïù∏ÏÑºÌã∞Î∏å</h2>
            <div class="incentive-grid">
                <div class="incentive-box">
                    <div class="label">100% ÏßÄÍ∏âÏï°</div>
                    <div class="amount" id="total100">0Ïõê</div>
                </div>
                <div class="incentive-box">
                    <div class="label">80% ÏßÄÍ∏âÏï°</div>
                    <div class="amount" id="total80">0Ïõê</div>
                </div>
                <div class="incentive-box funding">
                    <div class="label">ÌéÄÎî© Í∏àÏï°</div>
                    <div class="amount" id="totalFunding">0Ïõê</div>
                </div>
            </div>

            <div class="branch-section">
                <h3>üìä ÏßÄÏ†êÎ≥Ñ ÌòÑÌô©</h3>
                
                <div class="branch-card gyeyang">
                    <div class="branch-header">
                        <span class="branch-name">üü° Í≥ÑÏñë ÍøÄÌÜµ</span>
                        <a href="gyeyang.html" class="detail-btn">ÏÉÅÏÑ∏Î≥¥Í∏∞ ‚Üí</a>
                    </div>
                    <div class="branch-stats">
                        <div class="stat-item">
                            <div class="stat-label">Ï¥ù Ïã§Ï†Å</div>
                            <div class="stat-value" id="gyeyangCount">0Í±¥</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Ïù∏ÏÑºÌã∞Î∏å</div>
                            <div class="stat-value" id="gyeyangAmount">0Ïõê</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÌéÄÎî©</div>
                            <div class="stat-value" style="color: #E53935;" id="gyeyangFunding">0Ïõê</div>
                        </div>
                    </div>
                </div>

                <div class="branch-card yeonsu">
                    <div class="branch-header">
                        <span class="branch-name">üíñ Ïó∞Ïàò ÍøÄÌÜµ</span>
                        <a href="yeonsu.html" class="detail-btn">ÏÉÅÏÑ∏Î≥¥Í∏∞ ‚Üí</a>
                    </div>
                    <div class="branch-stats">
                        <div class="stat-item">
                            <div class="stat-label">Ï¥ù Ïã§Ï†Å</div>
                            <div class="stat-value" id="yeonsuCount">0Í±¥</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Ïù∏ÏÑºÌã∞Î∏å</div>
                            <div class="stat-value" id="yeonsuAmount">0Ïõê</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÌéÄÎî©</div>
                            <div class="stat-value" style="color: #E53935;" id="yeonsuFunding">0Ïõê</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="product-section">
            <h3>üìà ÏÉÅÌíàÎ≥Ñ ÌÜµÌï© ÌòÑÌô©</h3>
            
            <div class="product-item">
                <div class="product-name">100M ‚Üí 500M</div>
                <div class="product-details">
                    <span>Í≥ÑÏñë: <span id="case1_gy">0Í±¥</span></span>
                    <span>Ïó∞Ïàò: <span id="case1_ys">0Í±¥</span></span>
                    <span>Ìï©Í≥Ñ: <strong id="case1_total">0Í±¥</strong></span>
                </div>
                <div class="product-total" id="case1_amount">Ìï©Í≥Ñ: 0Ïõê</div>
            </div>

            <div class="product-item">
                <div class="product-name">500M ‚Üí 1G</div>
                <div class="product-details">
                    <span>Í≥ÑÏñë: <span id="case2_gy">0Í±¥</span></span>
                    <span>Ïó∞Ïàò: <span id="case2_ys">0Í±¥</span></span>
                    <span>Ìï©Í≥Ñ: <strong id="case2_total">0Í±¥</strong></span>
                </div>
                <div class="product-total" id="case2_amount">Ìï©Í≥Ñ: 0Ïõê</div>
            </div>

            <div class="product-item">
                <div class="product-name">100M ‚Üí 1G</div>
                <div class="product-details">
                    <span>Í≥ÑÏñë: <span id="case3_gy">0Í±¥</span></span>
                    <span>Ïó∞Ïàò: <span id="case3_ys">0Í±¥</span></span>
                    <span>Ìï©Í≥Ñ: <strong id="case3_total">0Í±¥</strong></span>
                </div>
                <div class="product-total" id="case3_amount">Ìï©Í≥Ñ: 0Ïõê</div>
            </div>

            <div class="product-item">
                <div class="product-name">TV ÏóÖÏÖÄ</div>
                <div class="product-details">
                    <span>Í≥ÑÏñë: <span id="case4_gy">0Í±¥</span></span>
                    <span>Ïó∞Ïàò: <span id="case4_ys">0Í±¥</span></span>
                    <span>Ìï©Í≥Ñ: <strong id="case4_total">0Í±¥</strong></span>
                </div>
                <div class="product-total" id="case4_amount">Ìï©Í≥Ñ: 0Ïõê</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyA89ZUSRGPxXiLetuKpBjvhLZ_EbabzQD0",
            authDomain: "honey-jina.firebaseapp.com",
            databaseURL: "https://honey-jina-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "honey-jina",
            storageBucket: "honey-jina.firebasestorage.app",
            messagingSenderId: "453703035842",
            appId: "1:453703035842:web:68ab1a1531b6345b79c45b"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;

        function calculateIncentive(caseNum, count) {
            if (count === 0) return 0;
            if (caseNum === 4) return count * 10000;
            
            let basic = 0, gradeRate = 0;
            if (caseNum === 1 || caseNum === 2) {
                basic = 10000;
                gradeRate = count <= 9 ? 20000 : count <= 11 ? 27000 : 35000;
            } else if (caseNum === 3) {
                basic = 30000;
                gradeRate = count <= 9 ? 60000 : count <= 11 ? 75000 : 90000;
            }
            return (basic * count) + (gradeRate * count);
        }

        function formatCurrency(amount) {
            return amount.toLocaleString('ko-KR') + 'Ïõê';
        }

        function updateMonthDisplay() {
            const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
            document.getElementById('currentMonth').textContent = `${currentYear}ÎÖÑ ${monthNames[currentMonth - 1]}`;
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            updateMonthDisplay();
            loadAllData();
        }

        window.changeMonth = changeMonth;

        async function loadBranchData(branch) {
            const monthStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}`;
            const branchRef = ref(database, `${branch}_records`);
            const snapshot = await get(branchRef);

            const counts = { case1: 0, case2: 0, case3: 0, case4: 0 };
            let totalAmount = 0;
            let totalCount = 0;
            let totalFunding = 0;

            if (snapshot.exists()) {
                const data = snapshot.val();
                Object.values(data).forEach(record => {
                    if (record.date && record.date.startsWith(monthStr)) {
                        counts.case1 += record.case1 || 0;
                        counts.case2 += record.case2 || 0;
                        counts.case3 += record.case3 || 0;
                        counts.case4 += record.case4 || 0;
                        totalFunding += record.funding || 0;
                    }
                });

                totalAmount = calculateIncentive(1, counts.case1) +
                             calculateIncentive(2, counts.case2) +
                             calculateIncentive(3, counts.case3) +
                             calculateIncentive(4, counts.case4) -
                             totalFunding;

                totalCount = counts.case1 + counts.case2 + counts.case3 + counts.case4;
            }

            return { counts, totalAmount, totalCount, totalFunding };
        }

        async function loadAllData() {
            try {
                const [gyeyang, yeonsu] = await Promise.all([
                    loadBranchData('gyeyang'),
                    loadBranchData('yeonsu')
                ]);

                // Ï†ÑÏ≤¥ Ìï©Í≥Ñ
                const totalAmount = gyeyang.totalAmount + yeonsu.totalAmount;
                const total80 = Math.floor(totalAmount * 0.8);
                const totalFunding = gyeyang.totalFunding + yeonsu.totalFunding;

                document.getElementById('total100').textContent = formatCurrency(totalAmount);
                document.getElementById('total80').textContent = formatCurrency(total80);
                document.getElementById('totalFunding').textContent = '-' + formatCurrency(totalFunding);

                // ÏßÄÏ†êÎ≥Ñ ÌòÑÌô©
                document.getElementById('gyeyangCount').textContent = gyeyang.totalCount + 'Í±¥';
                document.getElementById('gyeyangAmount').textContent = formatCurrency(gyeyang.totalAmount);
                document.getElementById('gyeyangFunding').textContent = '-' + formatCurrency(gyeyang.totalFunding);
                
                document.getElementById('yeonsuCount').textContent = yeonsu.totalCount + 'Í±¥';
                document.getElementById('yeonsuAmount').textContent = formatCurrency(yeonsu.totalAmount);
                document.getElementById('yeonsuFunding').textContent = '-' + formatCurrency(yeonsu.totalFunding);

                // ÏÉÅÌíàÎ≥Ñ ÌòÑÌô©
                for (let i = 1; i <= 4; i++) {
                    const gyCount = gyeyang.counts[`case${i}`];
                    const ysCount = yeonsu.counts[`case${i}`];
                    const totalCount = gyCount + ysCount;
                    const totalInc = calculateIncentive(i, gyCount) + calculateIncentive(i, ysCount);

                    document.getElementById(`case${i}_gy`).textContent = gyCount + 'Í±¥';
                    document.getElementById(`case${i}_ys`).textContent = ysCount + 'Í±¥';
                    document.getElementById(`case${i}_total`).textContent = totalCount + 'Í±¥';
                    document.getElementById(`case${i}_amount`).textContent = 'Ìï©Í≥Ñ: ' + formatCurrency(totalInc);
                }
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        updateMonthDisplay();
        loadAllData();
    </script>
</body>
</html>
